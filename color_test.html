<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax Color Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Include our custom CSS */
        /* In light mode: any green gets forced to DARK green */
        mjx-container *[style*="#00AA00"],
        mjx-container *[style*="#006600"],
        mjx-container *[style*="#00CC66"],
        mjx-container *[style*="rgb(0, 170, 0)"],
        mjx-container *[style*="rgb(0, 102, 0)"],
        mjx-container *[style*="rgb(0, 204, 102)"],
        mjx-container *[style*="rgb(0,170,0)"],
        mjx-container *[style*="rgb(0,102,0)"],
        mjx-container *[style*="rgb(0,204,102)"],
        .MathJax *[style*="#00AA00"],
        .MathJax *[style*="#006600"],
        .MathJax *[style*="#00CC66"],
        .MathJax *[style*="rgb(0, 170, 0)"],
        .MathJax *[style*="rgb(0, 102, 0)"],
        .MathJax *[style*="rgb(0, 204, 102)"] {
          color: #006600 !important; /* DARK green for light mode */
        }

        /* In dark mode: LIGHT green */
        [data-bs-theme="dark"] mjx-container *[style*="#00AA00"],
        [data-bs-theme="dark"] mjx-container *[style*="#006600"],
        [data-bs-theme="dark"] mjx-container *[style*="#00CC66"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0, 170, 0)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0, 102, 0)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0, 204, 102)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0,170,0)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0,102,0)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0,204,102)"],
        [data-bs-theme="dark"] .MathJax *[style*="#00AA00"],
        [data-bs-theme="dark"] .MathJax *[style*="#006600"],
        [data-bs-theme="dark"] .MathJax *[style*="#00CC66"],
        [data-bs-theme="dark"] .MathJax *[style*="rgb(0, 170, 0)"],
        [data-bs-theme="dark"] .MathJax *[style*="rgb(0, 102, 0)"],
        [data-bs-theme="dark"] .MathJax *[style*="rgb(0, 204, 102)"] {
          color: #90EE90 !important; /* LIGHT green for dark mode */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>MathJax Color Test</h1>
            <button id="themeToggle" class="btn btn-outline-secondary">Toggle Theme</button>
        </div>
        
        <div class="alert alert-info">
            <strong>Expected behavior:</strong>
            <ul>
                <li>Light mode: Equations should be dark green (#006600)</li>
                <li>Dark mode: Equations should be light green (#90EE90)</li>
            </ul>
        </div>
        
        <p>Current theme: <span id="currentTheme">light</span></p>
        
        <h3>Math Equations with Color Macros:</h3>
        <p>$$\color{rgb(0,204,102)}{y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \varepsilon}$$</p>
        <p>$$\color{rgb(0, 204, 102)}{P(Y=1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1)}}}$$</p>
        <p>$$\color{rgb(0,170,0)}{f(x) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}}$$</p>
        
        <div id="debug" class="mt-4 p-3 bg-light border" style="font-family: monospace; font-size: 12px;">
            <h5>Debug Info:</h5>
            <div id="debugOutput">Loading...</div>
        </div>
    </div>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script>
        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: {'[+]': ['color']},
            },
            chtml: {
                scale: 1,
                minScale: .5,
                matchFontHeight: false
            },
            startup: {
                ready() {
                    MathJax.startup.defaultReady();
                    setTimeout(forceColorOverride, 500);
                }
            }
        };

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const currentThemeSpan = document.getElementById('currentTheme');
        const htmlElement = document.documentElement;

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            htmlElement.setAttribute('data-bs-theme', newTheme);
            currentThemeSpan.textContent = newTheme;
            
            // Update debug info
            updateDebugInfo();
            
            // Force color override after theme change
            setTimeout(forceColorOverride, 100);
        });

        function forceColorOverride() {
            console.log('ðŸŽ¯ Running forceColorOverride...');
            
            const htmlTheme = document.documentElement.getAttribute('data-bs-theme');
            const isDark = htmlTheme === 'dark';
            const targetColor = isDark ? '#90EE90' : '#006600';
            
            console.log('Theme:', htmlTheme, 'isDark:', isDark, 'targetColor:', targetColor);
            
            // Look for all possible green colors that MathJax might use
            const greenPatterns = [
                '#00AA00', '#006600', '#00CC66', 
                'rgb(0, 170, 0)', 'rgb(0, 102, 0)', 'rgb(0, 204, 102)', 'rgb(0, 139, 69)',
                'rgb(0,170,0)', 'rgb(0,102,0)', 'rgb(0,204,102)', 'rgb(0,139,69)'
            ];
            
            let foundElements = 0;
            
            // Check all elements for any green color patterns
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                const style = el.getAttribute('style') || '';
                const hasAnyGreen = greenPatterns.some(pattern => style.includes(pattern));
                
                if (hasAnyGreen) {
                    console.log('âœ“ Found element with green color:', el.tagName, 'style:', style);
                    el.style.setProperty('color', targetColor, 'important');
                    foundElements++;
                }
            });
            
            console.log(`Total elements processed: ${foundElements}`);
            updateDebugInfo();
        }

        function updateDebugInfo() {
            const debugOutput = document.getElementById('debugOutput');
            const htmlTheme = document.documentElement.getAttribute('data-bs-theme');
            const mathElements = document.querySelectorAll('mjx-container *, .MathJax *');
            const coloredElements = document.querySelectorAll('[style*="color"]');
            
            let debugInfo = `
                <strong>Theme:</strong> ${htmlTheme}<br>
                <strong>Total math elements:</strong> ${mathElements.length}<br>
                <strong>Elements with color styling:</strong> ${coloredElements.length}<br>
                <strong>MathJax elements found:</strong>
            `;
            
            // Find MathJax elements with color
            let mathjaxColorCount = 0;
            mathElements.forEach((el, i) => {
                const style = el.getAttribute('style') || '';
                if (style.includes('color')) {
                    mathjaxColorCount++;
                    debugInfo += `<br>  ${i}: ${el.tagName} - ${style.substring(0, 100)}${style.length > 100 ? '...' : ''}`;
                }
            });
            
            debugInfo += `<br><strong>MathJax elements with color:</strong> ${mathjaxColorCount}`;
            
            debugOutput.innerHTML = debugInfo;
        }

        // Initial debug info
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(updateDebugInfo, 1000);
        });
    </script>
</body>
</html>
