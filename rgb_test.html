<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax RGB Color Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        /* Test CSS - exactly like our main file */
        mjx-container *[style*="rgb(0, 204, 102)"],
        mjx-container *[style*="rgb(0,204,102)"],
        mjx-container *[style*="color: rgb(0, 204, 102)"],
        mjx-container *[style*="color:rgb(0,204,102)"] {
          color: #006600 !important; /* DARK green for light mode */
          border: 2px solid red; /* DEBUG: make it obvious if CSS works */
        }

        [data-bs-theme="dark"] mjx-container *[style*="rgb(0, 204, 102)"],
        [data-bs-theme="dark"] mjx-container *[style*="rgb(0,204,102)"],
        [data-bs-theme="dark"] mjx-container *[style*="color: rgb(0, 204, 102)"],
        [data-bs-theme="dark"] mjx-container *[style*="color:rgb(0,204,102)"] {
          color: #90EE90 !important; /* LIGHT green for dark mode */
          border: 2px solid blue; /* DEBUG: make it obvious if CSS works */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>MathJax RGB Color Test</h1>
            <button id="themeToggle" class="btn btn-outline-secondary">Toggle Theme</button>
        </div>
        
        <p>Current theme: <span id="currentTheme">light</span></p>
        
        <h3>Test different ways to create green equations:</h3>
        
        <h4>1. Direct RGB color in math:</h4>
        <p>$$\color{rgb(0,204,102)}{y = \beta_0 + \beta_1 x_1}$$</p>
        
        <h4>2. RGB color with spaces:</h4>
        <p>$$\color{rgb(0, 204, 102)}{f(x) = x^2 + 1}$$</p>
        
        <h4>3. Using macro (should expand to RGB):</h4>
        <p id="macroTest">Loading macro test...</p>
        
        <div id="debug" class="mt-4 p-3 bg-light border">
            <h5>Debug Info:</h5>
            <div id="debugOutput">Waiting for MathJax...</div>
        </div>
    </div>

    <script>
        // MathJax configuration with macro
        window.MathJax = {
            loader: {load: ['[tex]/color']},
            tex: {
                packages: {'[+]': ['color']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                macros: {
                    lightgreen: "\\color{rgb(0,204,102)}"
                }
            },
            startup: {
                ready() {
                    console.log('üéØ MathJax starting up...');
                    MathJax.startup.defaultReady();
                    
                    MathJax.startup.promise.then(() => {
                        console.log('‚úÖ MathJax ready, adding macro test...');
                        
                        // Add the macro test after MathJax is ready
                        document.getElementById('macroTest').innerHTML = '$$\\lightgreen{z = ax + by + c}$$';
                        
                        // Re-render the new equation
                        MathJax.typesetPromise([document.getElementById('macroTest')]).then(() => {
                            console.log('‚úÖ Macro equation rendered');
                            analyzeElements();
                        });
                    });
                }
            }
        };

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const currentThemeSpan = document.getElementById('currentTheme');
        const htmlElement = document.documentElement;

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            htmlElement.setAttribute('data-bs-theme', newTheme);
            currentThemeSpan.textContent = newTheme;
            
            setTimeout(analyzeElements, 100);
        });

        function analyzeElements() {
            console.log('üîç Analyzing rendered elements...');
            
            const debugOutput = document.getElementById('debugOutput');
            const htmlTheme = document.documentElement.getAttribute('data-bs-theme');
            
            // Find all MathJax elements
            const mjxContainers = document.querySelectorAll('mjx-container');
            const mjxElements = document.querySelectorAll('mjx-container *');
            const coloredElements = document.querySelectorAll('[style*="color"]');
            const rgbElements = document.querySelectorAll('[style*="rgb(0"]');
            
            let debugInfo = `
                <strong>Theme:</strong> ${htmlTheme}<br>
                <strong>MathJax Containers:</strong> ${mjxContainers.length}<br>
                <strong>MathJax Elements:</strong> ${mjxElements.length}<br>
                <strong>Elements with color:</strong> ${coloredElements.length}<br>
                <strong>Elements with rgb(0...:</strong> ${rgbElements.length}<br><br>
                <strong>Detailed analysis:</strong><br>
            `;
            
            mjxContainers.forEach((container, i) => {
                debugInfo += `<br><strong>Container ${i}:</strong><br>`;
                const innerElements = container.querySelectorAll('*[style*="color"]');
                if (innerElements.length > 0) {
                    innerElements.forEach((el, j) => {
                        const style = el.getAttribute('style') || '';
                        debugInfo += `  Element ${j}: ${el.tagName} - ${style}<br>`;
                        
                        if (style.includes('rgb(0')) {
                            debugInfo += `    ‚úÖ Found RGB green element!<br>`;
                        }
                    });
                } else {
                    debugInfo += `  No colored elements found<br>`;
                }
            });
            
            // Log to console as well
            console.log('MathJax containers:', mjxContainers);
            console.log('Colored elements:', coloredElements);
            console.log('RGB elements:', rgbElements);
            
            debugOutput.innerHTML = debugInfo;
        }
    </script>
</body>
</html>
