<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Interactions of Binary Variables â€“ FIN5005 Fall 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b1eab047c83979204f5fc89f48c6bdb2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-f904b3a17f9ba91b23ca1e8d6d4821c4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-b1eab047c83979204f5fc89f48c6bdb2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- This is what works with Quarto and MathJax 3+ -->
<script>
  MathJax = {
    loader: { 
      load: ['[tex]/colorV2'] 
    },
    tex: {
      packages: { '[+]': ['color'] }, // load the colorV2 package
      inlineMath: [   // start/end delimiter pairs for in-line math
        ['$', '$'],
        ['\\(', '\\)']
      ],
      displayMath: [  // start/end delimiter pairs for display math
        ['$$', '$$'],
        ['\\[', '\\]']
      ],
      processEscapes: true, // use \$ to produce a literal dollar sign
      tags: 'ams',  // should be 'ams', 'none', or 'all'
      macros: {  //define TeX macros
        bold: ["{\\boldsymbol #1}", 1],  // use \bold as a shorthand
        indep: "{\\perp \\!\\!\\! \\perp}",
        vect: ["\\mathbf{#1}", 1],
        mat: ["\\mathbf{#1}", 1],

        bA: "\\boldsymbol{A}",
        bB: "\\boldsymbol{B}",
        bC: "\\boldsymbol{C}",
        bD: "\\boldsymbol{D}",
        bE: "\\boldsymbol{E}",
        bF: "\\boldsymbol{F}",
        bG: "\\boldsymbol{G}",
        bH: "\\boldsymbol{H}",
        bI: "\\boldsymbol{I}",
        bJ: "\\boldsymbol{J}",
        bK: "\\boldsymbol{K}",
        bL: "\\boldsymbol{L}",
        bM: "\\boldsymbol{M}",
        bN: "\\boldsymbol{N}",
        bP: "\\boldsymbol{P}",
        bQ: "\\boldsymbol{Q}",
        bR: "\\boldsymbol{R}",
        bS: "\\boldsymbol{S}",
        bT: "\\boldsymbol{T}",
        bU: "\\boldsymbol{U}",
        bV: "\\boldsymbol{V}",
        bW: "\\boldsymbol{W}",
        bX: "\\boldsymbol{X}",
        bY: "\\boldsymbol{Y}",
        bZ: "\\boldsymbol{Z}",
        ba: "\\boldsymbol{a}",
        bb: "\\boldsymbol{b}",
        bc: "\\boldsymbol{c}",
        bd: "\\boldsymbol{d}",
        be: "\\boldsymbol{e}",
        bg: "\\boldsymbol{g}",
        bh: "\\boldsymbol{h}",
        bi: "\\boldsymbol{i}",
        bm: "\\boldsymbol{m}",
        bp: "\\boldsymbol{p}",
        bq: "\\boldsymbol{q}",
        br: "\\boldsymbol{r}",
        bs: "\\boldsymbol{s}",
        bt: "\\boldsymbol{t}",
        bu: "\\boldsymbol{u}",
        bv: "\\boldsymbol{v}",
        bw: "\\boldsymbol{w}",
        bx: "\\boldsymbol{x}",
        by: "\\boldsymbol{y}",
        bz: "\\boldsymbol{z}",

        Acal: "\\mathcal{A}",
        Bcal: "\\mathcal{B}",
        Ccal: "\\mathcal{C}",
        Dcal: "\\mathcal{D}",
        Ecal: "\\mathcal{E}",
        Fcal: "\\mathcal{F}",
        Gcal: "\\mathcal{G}",
        Hcal: "\\mathcal{H}",
        Ical: "\\mathcal{I}",
        Jcal: "\\mathcal{J}",
        Kcal: "\\mathcal{K}",
        Lcal: "\\mathcal{L}",
        Mcal: "\\mathcal{M}",
        Ncal: "\\mathcal{N}",
        Ocal: "\\mathcal{O}",
        Pcal: "\\mathcal{P}",
        Qcal: "\\mathcal{Q}",
        Rcal: "\\mathcal{R}",
        Scal: "\\mathcal{S}",
        Tcal: "\\mathcal{T}",
        Ucal: "\\mathcal{U}",
        Vcal: "\\mathcal{V}",
        Wcal: "\\mathcal{W}",
        Xcal: "\\mathcal{X}",
        Ycal: "\\mathcal{Y}",
        Zcal: "\\mathcal{Z}",

        A: "\\mathbb{A}",
        B: "\\mathbb{B}",
        C: "\\mathbb{C}",
        D: "\\mathbb{D}",
        E: "\\mathbb{E}",
        F: "\\mathbb{F}",
        G: "\\mathbb{G}",
        H: "\\mathbb{H}",
        I: "\\mathbb{I}",
        J: "\\mathbb{J}",
        K: "\\mathbb{K}",
        L: "\\mathbb{L}",
        M: "\\mathbb{M}",
        N: "\\mathbb{N}",
        O: "\\mathbb{O}",
        P: "\\mathbb{P}",
        Q: "\\mathbb{Q}",
        R: "\\mathbb{R}",
        S: "\\mathbb{S}",
        T: "\\mathbb{T}",
        U: "\\mathbb{U}",
        V: "\\mathbb{V}",
        W: "\\mathbb{W}",
        X: "\\mathbb{X}",
        Y: "\\mathbb{Y}",
        Z: "\\mathbb{Z}",

        bAlpha: "\\boldsymbol{\\Alpha}",
        bBeta: "\\boldsymbol{\\beta}",
        bDelta: "\\boldsymbol{\\delta}",
        bEta: "\\boldsymbol{\\eta}",
        bGamma: "\\boldsymbol{\\Gamma}",
        bLambda: "\\boldsymbol{\\Lambda}",
        bOmega: "\\boldsymbol{\\Omega}",
        bPhi: "\\boldsymbol{\\Phi}",
        bPi: "\\boldsymbol{\\Pi}",
        bPsi: "\\boldsymbol{\\Psi}",
        bSigma: "\\boldsymbol{\\Sigma}",
        bTau: "\\boldsymbol{\\tau}",
        bXi: "\\boldsymbol{\\Xi}",
        bLambda: "\\boldsymbol{\\Lambda}",

        balpha: "\\boldsymbol{\\alpha}",
        bbeta: "\\boldsymbol{\\beta}",
        bepsilon: "\\boldsymbol{\\epsilon}",
        bvarepsilon: "\\boldsymbol{\\varepsilon}",
        bdelta: "\\boldsymbol{\\delta}",
        blambda: "\\boldsymbol{\\lambda}",
        bmu: "\\boldsymbol{\\mu}",
        bphi: "\\boldsymbol{\\phi}",
        bpi: "\\boldsymbol{\\pi}",
        bpsi: "\\boldsymbol{\\psi}",
        brho: "\\boldsymbol{\\rho}",
        bsigma: "\\boldsymbol{\\sigma}",
        btau: "\\boldsymbol{\\tau}",
        bxi: "\\boldsymbol{\\xi}",
        bEta: "\\boldsymbol{\\eta}",
        bPhi: "\\boldsymbol{\\Phi}",
        bPi: "\\boldsymbol{\\Pi}",
        bPsi: "\\boldsymbol{\\Psi}",
        bXi: "\\boldsymbol{\\Xi}",
        blambda: "\\boldsymbol{\\lambda}",
        bmu: "\\boldsymbol{\\mu}",
        bphi: "\\boldsymbol{\\phi}",
        bpi: "\\boldsymbol{\\pi}",
        bpsi: "\\boldsymbol{\\psi}",
        brho: "\\boldsymbol{\\rho}",
        bsigma: "\\boldsymbol{\\sigma}",

        curl: ["\\left\\lbrace#1\\right\\rbrace", 1],
        floor: ["\\left\\lfloor#1\\right\\rfloor", 1],
        ceil: ["\\left\\lceil#1\\right\\rceil", 1],
        abs: ["\\left\\lvert#1\\right\\rvert", 1],
        norm: ["\\left\\lVert#1\\right\\rVert", 1],

        independent: "\\mathrel{\\perp\\!\\!\\perp}",

        var: "\\mathrm{Var}",
        cov: "\\mathrm{Cov}",
        cor: "\\mathrm{Corr}",
        diag: "\\mathrm{diag}",
        rank: "\\mathrm{rank}",
        vecc: "\\mathrm{vec}",
        
        // define colors
        red: ["{\\color[RGB]{246, 87, 55}{#1}}", 1],
        green: ["{\\color[RGB]{0, 204, 102}{#1}}", 1], // #00CC66
      }
    }
  };
</script>
<!-- ===================== Icon Library ====================== -->
<!-- load Font Awesome 6 icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
<!-- Load MS codicon library -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vscode/codicons@latest/dist/codicon.css">

<!-- ============== js for show/hide solutions ================ -->
<script language="JavaScript" src="themes/my_jxscript.js"></script>



  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">FIN5005 Fall 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./08_Interactions.html">Interactions of Binary Variables</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_environment_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment Setup</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability and Data in Business Analytics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_Lab-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Probability &amp; Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Data_Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Linear_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Theoretical_Framework_LR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Theoretical Framework of Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Hypothesis_Testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Testing and Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_Multiple_Linear_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Lab-2_dummy-variable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Regression with Dummy Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_Interactions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Interactions of Binary Variables</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#interactions-of-two-binary-variables" id="toc-interactions-of-two-binary-variables" class="nav-link active" data-scroll-target="#interactions-of-two-binary-variables"><span class="header-section-number">1</span> Interactions of Two Binary Variables</a>
  <ul>
  <li><a href="#add-more-controls-variables" id="toc-add-more-controls-variables" class="nav-link" data-scroll-target="#add-more-controls-variables"><span class="header-section-number">1.1</span> Add More Controls Variables</a></li>
  <li><a href="#two-way-anova-mathematical-formulation" id="toc-two-way-anova-mathematical-formulation" class="nav-link" data-scroll-target="#two-way-anova-mathematical-formulation"><span class="header-section-number">1.2</span> Two-Way ANOVA Mathematical Formulation</a></li>
  </ul></li>
  <li><a href="#interactions-of-a-binary-variable-and-a-continuous-variable" id="toc-interactions-of-a-binary-variable-and-a-continuous-variable" class="nav-link" data-scroll-target="#interactions-of-a-binary-variable-and-a-continuous-variable"><span class="header-section-number">2</span> Interactions of a Binary Variable and a Continuous Variable</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./08_Interactions.html">Interactions of Binary Variables</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Interactions of Binary Variables</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>ðŸŽ¯ <strong>Study Objectives</strong></p>
<ul>
<li>Interpret interaction terms of two binary variables in regression models.</li>
<li>Understand the importance of controlling for changes in interacting variables when interpreting coefficients.</li>
<li>Conduct and interpret a two-way ANOVA to compare nested regression models.</li>
<li>Interpret interaction terms between a binary variable and a continuous variable in regression models.</li>
<li>Visualize interaction effects using regression lines.</li>
</ul>
</div>
</div>
</div>
<p>For this section of the course, we will be working with the <code>Boston</code> dataset, which contains 506 observations on housing values in various suburbs of Boston. This dataset provides detailed information on factors such as crime rates, property age, locations (proximity to the Charles River), and other socioeconomic variables.</p>
<p>We will use this data to <strong>explore and analyze the determinants of housing prices</strong>, applying regression techniques to understand how different factors influence the value of homes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages and dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"MASS"</span>, <span class="st">"data.table"</span>, <span class="st">"stargazer"</span>, <span class="st">"cowplot"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>missing <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(pkgs, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">install.packages</span>(missing)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(pkgs, <span class="cf">function</span>(pkg) <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston) <span class="co"># Boston housing data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>?Boston</code> to see the description of the dataset.</p>
<p>Here are some variables in the dataset which we are going to use in this session.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 86%">
</colgroup>
<thead>
<tr class="header">
<th>Variables</th>
<th>Definitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>medv</code></td>
<td>median value of owner-occupied homes in $1000s.</td>
</tr>
<tr class="even">
<td><code>lstat</code></td>
<td>the percentage of individuals with low socioeconomic status</td>
</tr>
<tr class="odd">
<td><code>indus</code></td>
<td>proportion of non-retail business acres per town; industrial, office, or commercial land not directly serving consumers.</td>
</tr>
<tr class="even">
<td><code>age</code></td>
<td>proportion of owner-occupied units built prior to 1940.</td>
</tr>
<tr class="odd">
<td><code>crim</code></td>
<td>per capita crime rate by town.</td>
</tr>
<tr class="even">
<td><code>chas</code></td>
<td>A dummy variable. Takes the value 1 if the Charles River (a short river in the proximity of Boston) passes through the suburb and is 0 otherwise.</td>
</tr>
</tbody>
</table>
<section id="interactions-of-two-binary-variables" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="interactions-of-two-binary-variables"><span class="header-section-number">1</span> Interactions of Two Binary Variables</h2>
<p>Consider the following regression model</p>
<p><span id="eq-binary-interaction"><span class="math display">\[
medv_i = \beta_0 + \beta_1\, chas_i + \beta_2\, old_i + \beta_3\, (chas_i \times old_i) + u_i
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(chas_i\)</span> and <span class="math inline">\(old_i\)</span> are dummy variables defined as follows:</p>
<p><span class="math display">\[
\begin{aligned}
chas_i &amp;= \begin{cases}
1 &amp; \text{if the suburb is next to the Charles River} \\
0 &amp; \text{otherwise}
\end{cases} \\
old_i &amp;= \begin{cases}
1 &amp; \text{if } age_i \ge 95 \\
0 &amp; \text{otherwise}
\end{cases}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(agi_i\)</span> being the proportion of owner-occupied units built prior to 1940.</p>
<p><strong>Instructions:</strong></p>
<ul>
<li>Generate and append the binary variable <span class="math inline">\(old\)</span> to the dataset Boston.</li>
<li>Conduct the regression stated above and assign the result to <code>mod_bb</code>.</li>
<li>Obtain a robust coefficient summary of the model. How do you interpret the results?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Boston <span class="ot">&lt;-</span> Boston <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">old =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;=</span> <span class="dv">95</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>mod_bb <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> chas<span class="sc">*</span>old, <span class="at">data =</span> Boston)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_bb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = medv ~ chas * old, data = Boston)

Residuals:
    Min      1Q  Median      3Q     Max 
-17.771  -4.765  -1.683   2.776  33.433 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  23.6989     0.4503  52.624  &lt; 2e-16 ***
chas          4.0582     1.6872   2.405   0.0165 *  
old          -7.1319     0.9493  -7.513 2.67e-13 ***
chas:old     10.5462     3.7577   2.807   0.0052 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.604 on 502 degrees of freedom
Multiple R-squared:  0.1301,    Adjusted R-squared:  0.1249 
F-statistic: 25.02 on 3 and 502 DF,  p-value: 4.244e-15</code></pre>
</div>
</div>
<p>The estimated regression model is given by</p>
<p><span class="math display">\[
\widehat{medv}_i = 23.70 + 4.06\, chas_i - 7.13\, old_i + 10.55\, (chas_i \times old_i)
\]</span></p>
<p><span class="env-green"><strong>Interpretation of the coefficients</strong></span></p>
<p>We start with listing all possible combinations of the binary variables <span class="math inline">\(chas_i\)</span> and <span class="math inline">\(old_i\)</span>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th><span class="math inline">\(chas_i\)</span></th>
<th><span class="math inline">\(old_i\)</span></th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>1</strong></td>
<td>0</td>
<td>0</td>
<td>Suburb not next to Charles River and new</td>
</tr>
<tr class="even">
<td><strong>2</strong></td>
<td>0</td>
<td>1</td>
<td>Suburb not next to Charles River and old</td>
</tr>
<tr class="odd">
<td><strong>3</strong></td>
<td>1</td>
<td>0</td>
<td>Suburb next to Charles River and new</td>
</tr>
<tr class="even">
<td><strong>4</strong></td>
<td>1</td>
<td>1</td>
<td>Suburb next to Charles River and old</td>
</tr>
</tbody>
</table>
<p>Based on the estimated regression model, we can compute the expected value of <code>medv</code> for each of the four groups.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 16%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Scenario</th>
<th style="text-align: center;"><span class="math inline">\(chas_i\)</span></th>
<th style="text-align: center;"><span class="math inline">\(old_i\)</span></th>
<th style="text-align: center;"><span class="math inline">\(chas_i \times old_i\)</span></th>
<th style="text-align: left;">Expected value of <code>medv</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>1</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: left;"><span class="math inline">\(\color{#0099FF}{\hat{\beta}_0} = 23.70\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>2</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: left;"><span class="math inline">\({\color{#0099FF}\hat{\beta}_0} + {\color{#00CC66}\hat{\beta}_2} = {\color{#0099FF}23.70} + {\color{#00CC66}(- 7.13)} = 16.57\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>3</strong></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: left;"><span class="math inline">\({\color{#0099FF}\hat{\beta}_0} + {\color{#fb5b89}\hat{\beta}_1} = {\color{#0099FF}23.70} + {\color{#fb5b89}4.06} = 27.76\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>4</strong></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;"><span class="math inline">\({\color{#0099FF}\hat{\beta}_0} + {\color{#fb5b89}\hat{\beta}_1} + {\color{#00CC66}\hat{\beta}_2} + {\color{orange}\hat{\beta}_3} = {\color{#0099FF}23.70} + {\color{#fb5b89}4.06} + {\color{#00CC66}(-7.13)} + {\color{orange}(10.55)} = 31.18\)</span></td>
</tr>
</tbody>
</table>
<p>From the table above, we can interpret the coefficients as follows:</p>
<ul>
<li><p><span class="math inline">\(\color{#0099FF}{\hat{\beta}_0} = 23.70\)</span> is the expected value of <code>medv</code> for suburbs that are not next to the Charles River and are new (i.e., <code>old = 0</code>).</p></li>
<li><p>Comparing scenario 2 with 1: <span class="math inline">\(\color{#00CC66}{\hat{\beta}_2} = -7.13\)</span> is the difference in expected value of <code>medv</code> between new and old suburbs that are <strong>NOT next to the Charles River</strong>.</p>
<p>In other words, old suburbs that are not next to the Charles River have an expected <code>medv</code> that is 7.13 lower than new suburbs that are <strong>NOT next to the Charles River</strong>.</p></li>
<li><p>Comparing scenario 3 with 1: <span class="math inline">\(\color{#fb5b89}{\hat{\beta}_1} = 4.06\)</span> is the difference in expected value of <code>medv</code> between suburbs that are next to the Charles River and those that are not, among <strong>new</strong> suburbs (i.e., <code>old = 0</code>).</p>
<p>In other words, <strong>new</strong> suburbs that are next to the Charles River have an expected <code>medv</code> that is 4.06 higher than new suburbs that are not next to the Charles River.</p></li>
<li><p><span class="math inline">\(\color{orange}{\hat{\beta}_3} = 10.55\)</span> has two interpretations:</p>
<ul>
<li><p>If we compare scenario 4 with scenario 2, the difference in expected value of <code>medv</code> is given by <span class="math inline">\({\color{#fb5b89}\hat{\beta}_1} + {\color{orange}\hat{\beta}_3} = 4.06 + 10.55 = 14.61.\)</span></p>
<p>This means that <strong>old</strong> suburbs that are next to the Charles River have an expected <code>medv</code> that is 14.61 higher than <strong>old</strong> suburbs that are not next to the Charles River.</p>
<p>â†’ <span class="math inline">\(\color{orange}{\hat{\beta}_3}\)</span> can be interpreted as the difference in the effect of being next to the Charles River <u>between old and new suburbs</u>.</p></li>
<li><p>If we compare scenario 4 with scenario 3, the difference in expected value of <code>medv</code> is given by <span class="math inline">\({\color{#00CC66}\hat{\beta}_2} + {\color{orange}\hat{\beta}_3} = -7.13 + 10.55 = 3.42.\)</span></p>
<p>This means that old suburbs that are <strong>next to the Charles River</strong> have an expected <code>medv</code> that is 3.42 higher than new suburbs that are <strong>next to the Charles River</strong>.</p>
<p>â†’ <span class="math inline">\(\color{orange}{\hat{\beta}_3}\)</span> can be interpreted as the difference in the effect of being old <u>between suburbs that are next to the Charles River and those that are not</u>.</p></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="env-green"><strong>Controlling for changes in the interacting variables</strong></span> is essential when interpreting the coefficient of interaction terms.</p>
<p>A common approach is to substitute specific values for the interacting variables and compute the expected value of the dependent variable under different scenarios. This allows for a clearer interpretation of the coefficients by comparing how the expected value of the dependent variable varies across these scenarios.</p>
</div>
</div>
<section id="add-more-controls-variables" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="add-more-controls-variables"><span class="header-section-number">1.1</span> Add More Controls Variables</h3>
<p>We can also add more control variables to <a href="#eq-binary-interaction" class="quarto-xref">Equation&nbsp;1</a> to improve the model fit (Adjusted <span class="math inline">\(R^2 = 12\%\)</span> as of now). For example, we can add <code>lstat</code> and <code>crim</code> as additional control variables.</p>
<p><span id="eq-binary-interaction-more-controls"><span class="math display">\[
medv_i = \beta_0 + \beta_1\, chas_i + \beta_2\, old_i + \beta_3\, (chas_i \times old_i) + \beta_4\, lstat_i + \beta_5\, crim_i + u_i
\tag{2}\]</span></span></p>
<p>We estimate the above regression model as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod_bb2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> chas <span class="sc">*</span> old <span class="sc">+</span> lstat <span class="sc">+</span> crim, <span class="at">data =</span> Boston)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder the variables for stargazer output</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>vars.order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"chas"</span>, <span class="st">"old"</span>, <span class="st">"chas:old"</span>, <span class="st">"lstat"</span>, <span class="st">"crim"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod_bb, mod_bb2,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"text"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">"Restricted"</span>, <span class="st">"Unrestricted"</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">paste0</span>(<span class="st">"^"</span>, vars.order, <span class="st">"$"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================================================
                                  Dependent variable:               
                    ------------------------------------------------
                                          medv                      
                          Restricted              Unrestricted      
                              (1)                     (2)           
--------------------------------------------------------------------
chas                        4.058**                 4.000***        
                            (1.687)                 (1.183)         
                                                                    
old                        -7.132***                1.748**         
                            (0.949)                 (0.776)         
                                                                    
chas:old                   10.546***                 4.008          
                            (3.758)                 (2.651)         
                                                                    
lstat                                              -0.949***        
                                                    (0.046)         
                                                                    
crim                                                -0.079**        
                                                    (0.036)         
                                                                    
Constant                   23.699***               34.106***        
                            (0.450)                 (0.573)         
                                                                    
--------------------------------------------------------------------
Observations                  506                     506           
R2                           0.130                   0.574          
Adjusted R2                  0.125                   0.570          
Residual Std. Error    8.604 (df = 502)         6.033 (df = 500)    
F Statistic         25.017*** (df = 3; 502) 134.705*** (df = 5; 500)
====================================================================
Note:                                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p><strong>Comparing the two models:</strong></p>
<ul>
<li>The coefficient of <code>old</code> reversed signs, from negative (<span class="math inline">\(-7.13\)</span>) to positive (<span class="math inline">\(1.75\)</span>), suggesting that after accounting for crime and low socioeconomic status, older suburbs have slightly higher values.</li>
<li>Negative coefficients for <code>lstat</code> (<span class="math inline">\(-0.95\)</span>) and <code>crim</code> (<span class="math inline">\(-0.079\)</span>) indicate that higher poverty and crime reduce house values.</li>
</ul>
<p>Plot <code>lstat</code> and <code>crim</code> group by <code>old</code> to see how the distribution of these two variables differ between new and old suburbs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Boston, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(old), <span class="at">y =</span> lstat)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Boston, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(old), <span class="at">y =</span> crim)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(p1, p2, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08_Interactions_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that old suburbs tend to have higher <code>lstat</code> and <code>crim</code> values compared to new suburbs. This suggests that controlling for these variables is important when examining the relationship between <code>medv</code>, <code>chas</code>, and <code>old</code>.</p>
</section>
<section id="two-way-anova-mathematical-formulation" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="two-way-anova-mathematical-formulation"><span class="header-section-number">1.2</span> Two-Way ANOVA Mathematical Formulation</h3>
<p>We now conduct a two-way ANOVA to formally compare the two models <code>mod_bb</code> and <code>mod_bb2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_bb, mod_bb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: medv ~ chas * old
Model 2: medv ~ chas * old + lstat + crim
  Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
1    502 37161                                  
2    500 18200  2     18961 260.45 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="step-list">
<ol type="1">
<li><p>State the null and alternative hypotheses. <span class="math display">\[
\begin{aligned}
H_0 &amp;: \beta_4 = 0 \text{ and } \beta_5 = 0 \\
H_1 &amp;: \beta_4 \ne 0 \text{ or } \beta_5 \ne 0
\end{aligned}
\]</span></p>
<p>In plain language:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: The additional variables <code>lstat</code> and <code>crim</code> do not improve the model fit.</li>
<li><span class="math inline">\(H_1\)</span>: At least one of the additional variables <code>lstat</code> or <code>crim</code> improves the model fit.</li>
</ul></li>
<li><p>Calculate the F-statistic.</p>
<p>The F-statistic is based on the <span class="math inline">\(R^2\)</span> of the two regressions: <span class="math display">\[
F = \left(\frac{n - k_U -1}{p}\right) \left(\frac{R_U^2-R_R^2}{1-R_U^2}\right) \sim F(p, n-k_U-1) .
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(n = 506\)</span> is the number of observations;</li>
<li><span class="math inline">\(k_U = 5\)</span> is the number of predictors in the unrestricted model (where <span class="math inline">\(H_1\)</span> is allowed to be true), excluding the intercept;</li>
<li><span class="math inline">\(p = 2\)</span> is the number of restrictions (i.e., the number of additional variables in the unrestricted model);</li>
<li><span class="math inline">\(R_U^2 = 0.574\)</span> is the <span class="math inline">\(R^2\)</span> of the unrestricted model;</li>
<li><span class="math inline">\(R_R^2 = 0.130\)</span> is the <span class="math inline">\(R^2\)</span> of the restricted model.</li>
</ul>
<p>Plug in the numbers, we get <span class="math display">\[
F = \left(\frac{506-5-1}{2}\right) \left(\frac{0.574-0.130}{1-0.574}\right) = 260.56
\]</span></p></li>
<li><p>Find the critical value</p>
<p>The F-statistic follows an <span class="math inline">\(F(2, 502)\)</span> distribution under the null hypothesis. At 5% significance level, we use the the critical value <span class="math inline">\(F_{2,\infty}=3.00.\)</span></p></li>
<li><p>Decision rule.</p>
<p>Since the calculated F-statistic (<span class="math inline">\(260.56\)</span>) is much larger than the critical value (<span class="math inline">\(3.00\)</span>), we reject the null hypothesis.</p>
<p>This suggests that at least one of <code>lstat</code> and <code>crim</code> significantly improves the model fit.</p></li>
<li><p>Conclusion.</p>
<p>We conclude that model (2) with additional control variables <code>lstat</code> and <code>crim</code> provides a significantly better fit to the data compared to model (1) without these controls.</p></li>
</ol>
</div>
</section>
</section>
<section id="interactions-of-a-binary-variable-and-a-continuous-variable" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="interactions-of-a-binary-variable-and-a-continuous-variable"><span class="header-section-number">2</span> Interactions of a Binary Variable and a Continuous Variable</h2>
<p>An interaction between a binary variable and a continuous variable shows how the effect of the continuous variable changes depending on the group. This helps us see differences that a simple line wouldnâ€™t capture. For example, the effect of business area on house prices might be different in new versus old suburbs.</p>
<p>Now consider the regression model</p>
<p><span class="math display">\[
medv_i = \beta_0 + \beta_1 \times indus_i + \beta_2 \times old_i + \beta_3 \times (indus_i\times old_i) + u_i
\]</span></p>
<p>where <span class="math inline">\(indus_i\)</span> being the proportion of non-retail business acres in suburb <span class="math inline">\(i\)</span>; <span class="math inline">\(old_i\)</span> is the same binary variable as defined above, indicating if the suburb is new.</p>
<p><strong>Instructions:</strong></p>
<ul>
<li>Estimate the above regression model and assign the result to <code>mod_bc</code>.</li>
<li>What is the relationship between <code>medv</code> and <code>indus</code> for new suburbs? What about old suburbs?</li>
<li>Is the effect of <code>indus</code> on <code>medv</code> statistically different between new and old suburbs?</li>
<li>Plot <code>medv</code> against <code>indus</code> and add the regression lines for both states of the binary variable <code>old</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mod_bc <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> indus <span class="sc">*</span> old, <span class="at">data =</span> Boston)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_bc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = medv ~ indus * old, data = Boston)

Residuals:
    Min      1Q  Median      3Q     Max 
-12.379  -5.066  -1.588   3.015  33.046 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 30.06350    0.72882  41.250   &lt;2e-16 ***
indus       -0.65844    0.06569 -10.024   &lt;2e-16 ***
old         -7.48438    3.07918  -2.431   0.0154 *  
indus:old    0.37115    0.17558   2.114   0.0350 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.024 on 502 degrees of freedom
Multiple R-squared:  0.2434,    Adjusted R-squared:  0.2389 
F-statistic: 53.83 on 3 and 502 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The estimated regression model is given by</p>
<p><span class="math display">\[
\widehat{medv}_i = 30.06 - 0.66 \times indus_i - 7.48 \times old_i + 0.37 \times (indus_i \cdot old_i)
\]</span></p>
<p><span class="env-green"><strong>Interpretation of the coefficients</strong></span></p>
<ul>
<li><p>For new suburbs (i.e., <code>old = 0</code>), the relationship between <code>medv</code> and <code>indus</code> is given by</p>
<p><span class="math display">\[
E(medv_i | old_i = 0) = \hat{\beta}_0 + \hat{\beta}_1 \times indus_i = 30.06 - 0.66 \times indus_i
\]</span></p>
<p>Thus, for new suburbs, a one-unit increase in <code>indus</code> is associated with a decrease in the expected value of <code>medv</code> by 0.66.</p></li>
<li><p>For old suburbs (i.e., <code>old = 1</code>), the relationship between <code>medv</code> and <code>indus</code> is given by</p>
<p><span class="math display">\[
\begin{split}
E(medv_i | old_i = 1) &amp;= (\hat{\beta}_0 + \hat{\beta}_2) + (\hat{\beta}_1 + \hat{\beta}_3) \times indus_i \\
&amp;= (30.06 - 7.48) + (-0.66 + 0.37) \times indus_i \\
&amp;= 22.58 - 0.29 \times indus_i
\end{split}
\]</span></p>
<p>Thus, for old suburbs, a one-unit increase in <code>indus</code> is associated with a decrease in the expected value of <code>medv</code> by 0.29. The negative effect is smaller in old suburbs due to the positive interaction term (<span class="math inline">\(\hat{\beta}_3 = 0.37\)</span>).</p></li>
<li><p>The effect of <code>indus</code> on <code>medv</code> is statistically different between new and old suburbs at 5% significance level given that the coefficient of the interaction term (<span class="math inline">\(\hat{\beta}_3\)</span>) is statistically significant.</p></li>
</ul>
<p><strong>Visualization</strong></p>
<p>Now we plot <code>medv</code> against <code>indus</code> with regression lines for both states of the binary variable <code>old</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Boston, <span class="fu">aes</span>(<span class="at">x =</span> indus, <span class="at">y =</span> medv, <span class="at">color =</span> <span class="fu">factor</span>(old))) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Proportion of Non-Retail Business Acres (indus)"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Median Home Value (medv)"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Old Suburb (old)"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"red"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"New Suburb"</span>, <span class="st">"Old Suburb"</span>)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="08_Interactions_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that the slope of the regression line for new suburbs (blue) is steeper than that for old suburbs (red), indicating a stronger negative relationship between <code>medv</code> and <code>indus</code> in new suburbs compared to old suburbs. This visual representation aligns with our earlier interpretation of the regression coefficients.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>